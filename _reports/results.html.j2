{# description: top-level integration results tests #}
<h2>Integration test results</h2>
{% set data_path = results._path.split('/',3) %}
<table>
{% for hdr in ('Device','Provider','Test suite') %}
{%   if data_path|length >= loop.index %}
  <tr>
    <th>{{ hdr }}</td>
    <td>{{ data_path[loop.index - 1] }}</td>
  </tr>
{%   endif %}
{% endfor %}
</table>
<hr>

{#
   Display summary test result with pointer to the next HTML file
#}
{% macro suite_result(t_data,cnt,txt,show_final = False) %}
<td>
{%   if cnt in t_data._count %}
  {{ t_data._count[cnt] }} {{ txt }}{% if show_final and 'pass' in t_data._count %},{% endif %}
{%   elif not show_final %}
  passed
{%   endif %}
{%   if show_final and 'pass' in t_data._count %}
  {{ t_data._count.pass }} passed
{%   endif %}
</td>
{% endmacro %}
{#
   Display individual test result with pointer to the log file
#}
{% macro test_result(t_name,t_data,cnt,fname) %}
<td>
{%   if cnt in t_data %}
  <a href="../{{ results._path }}/{{ t_name }}.yml-{{ fname }}.log">
{{ 'passed' if t_data[cnt] else 'failed' }}
  </a>
{%   endif %}
{% endmacro %}
</td>
<table>
  <tr>
    <th>Test</th>
    <th>Supported</th>
    <th>Configured</th>
    <th>Validated</th>
  </tr>
{% for test in results.keys()|sort if '_' not in test %}
{%   set t_data = results[test] %}
{%   if '_path' in t_data %}
  <tr>
    <td><a href="{{ t_data._path.replace('/','-') }}.html">{{ test }}</a></td>
    {{ suite_result(t_data,'unsupported','not supported') }}
    {{ suite_result(t_data,'config','configuration failed') }}
    {{ suite_result(t_data,'validate','validation failed',True) }}
  </tr>
{%   else %}
  <tr>
    <td>{{ test }}</td>
    {{ test_result(test,t_data,'supported','create') }}
    {{ test_result(test,t_data,'config','initial') }}
    {{ test_result(test,t_data,'validate','validate') }}
  </tr>
{%  endif %}
{% endfor %}
</table>
