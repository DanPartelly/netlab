!
router bgp {{ bgp.as }}
 address-family evpn
!
{% for n in bgp.neighbors if n.ipv4 is defined and n.evpn|default(False) %}
  neighbor {{ n.ipv4 }} activate
{% endfor %}
{% if vlans is defined %}
{%   for v in vlans.values() if v.evpn.evi is defined %}
!
 vlan {{ v.id }}
  rd {{ v.evpn.rd }}
  route-target import {{ v.evpn.import|join(' ') }}
  route-target export {{ v.evpn.export|join(' ') }}
  redistribute learned
{%   endfor %}
{% endif %}
{% if vrfs is defined %}
{%   for n,v in vrfs.items() if v.evpn.vlans is defined %}
!
 vlan-aware-bundle {{ n }}
  rd {{ v.rd }}
  route-target import {{ v.import|join(' ') }}
  route-target export {{ v.export|join(' ') }}
  redistribute learned
  vlan {{ v.evpn.vlan_ids|join(',') }}
{%   endfor %}
{% endif %}
